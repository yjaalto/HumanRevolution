<div class="bg-light collapse" id="navbarHeader">
    <div class="container">
        <div class="row">
            <div class="col-sm-8 col-md-7 py-4">
                <h4 class="text-dark">MNHR에 대하여</h4>
                <p class="text-muted">My New Human Revolution<br>
                    나만의 신 인간혁명
                </p>
                <p class="text-muted">매일매일 책을 단 한 페이지라도 읽고 소감과 실천기를 작성해 공유해봅시다. 📚📝</p>
            </div>
            <div class="col-sm-4 offset-md-1 py-4">
                <h4 class="text-dark">문의</h4>
                <ul class="list-unstyled">
                    <li class="text-dark"><i class="fas fa-mobile-alt"></i> 최연정 010-8914-4601</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="navbar navbar-light bg-light shadow-sm">
    <div class="container d-flex justify-content-between">
        <a href="/" class="navbar-brand d-flex align-items-center">
            <i class="fas fa-book"></i>&nbsp;
            <strong>MNHR</strong>
        </a>
        <div class="d-flex justify-content-end align-items-center">
            <% if(locals.penName) { %>
            <div class="avatar dropdown mr-2">
                <a data-toggle="dropdown" href="#">
                    <% if(locals.avatar) { %>
                        <img src="/uploads/<%= avatar %>" alt="프로필 사진">
                    <%} else { %>
                        <img src="/images/profile_none.png" alt="">
                    <% } %>
                </a>
                <b class="caret"></b>
                <ul class="dropdown-menu" role="menu">
                    <h6 class="dropdown-header"><% if(locals.penName){ %>
                        <%=penName %>
                        <% } %></h6>
                    <div class="dropdown-divider"></div>
                    <li role="presentation"><a role="menuitem" tabindex="-1" data-toggle="modal"
                            data-target="#profileModal">수정</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-3" href="/logout">로그아웃</a></li>

                </ul>
            </div>
            <%}  else { %>
            <a class="btn btn-sm btn-outline-secondary mr-2 p-2" href="/auth/login">로그인</a>
            <% } %>
            <!--  -->
            <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarHeader"
                aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </div>
</div>

<% if(locals.userInfo) { %>
<div class="modal fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="profileModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <form id="formUser" action="/auth/update_process" method="post">
                <input id="id" type="hidden" name="id">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">수정</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="container">
                        <label for="profile_img">프로필 사진 변경</label>
                        <div>
                            <% if(locals.avatar) { %>
                            <% if(userInfo.avater == '') { %>
                            <img src="/images/profile_none.png" alt="">
                            <%} else { %>
                            <img src="/uploads/<%= avatar %>" alt="프로필 사진">
                            <% }%>
                            <% } %>
                        </div>
                        <input type="file" name="profile_img" id="profile_img" class="sr-only">
                        <label for="name">필명</label>
                        <input id="name" class="form-control" name="penName">
                        <label for="comment">결의 한마디</label>
                        <textarea id="comment" class="form-control" name="comment"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                    <button type="submit" class="btn btn-primary">수정</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        let userInfo = '<%- userInfo %>';

        if (userInfo !== '') {
            $('#id').val('<%- userInfo.userName %>');
            $('#name').val('<%- userInfo.penName %>');
            $('#comment').val('<%- userInfo.comment %>');
        }
    });

    $("#formUser").on("submit", function (e) {
        e.preventDefault();

        var data = {};
        data.id = $('#id').val();
        data.penName = $("#name").val();
        data.comment = $("#comment").val();
        //data.author = $("#author option:selected").val();

        $.ajax({
            url: $(this).attr('action'),
            type: 'POST',
            data: data,
            success: function (result) {}
        });

        $("#profileModal").modal('hide');
    });

    $("#profileModal").on('hidden.bs.modal', function () {
        location.reload();
    });
</script>
<% } %>