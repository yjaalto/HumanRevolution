<!DOCTYPE html>
<html lang="ko">

<head>
    <% include ./head %>
    <title><%=title%></title>
</head>

<body>
    <header>
        <% var penName = penName; %>
        <% var avatar = avatar; %>
        <% var userInfo = userInfo; %>
        <% include ./header %>
    </header>
    <main role="main" class="content">
        <section class="jumbotron text-center">
            <div class="container">
                <h1 class="jumbotron-heading" style="font-family: 'Kaushan Script'">My New Human Revolution</h1>
                <p class="lead text-white h6" style="font-family: 'Spoqa Han Sans'">ëª©í‘œë¥¼ í•˜ë£¨ ë‹¬ì„±í•˜ë©´ <b>í•˜ë£¨ë¶„ì˜ ì¸ê°„í˜ëª…ì˜ ì´ì•¼ê¸°</b>ê°€
                    íƒ„ìƒí•©ë‹ˆë‹¤.<br>
                    ì–´ë””ê¹Œì§€ë‚˜ ìŠ¤ìŠ¤ë¡œ ì •í•©ì‹œë‹¤. ìê¸°ë‹µê²Œ ë…¸ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.<br>ëˆ„êµ°ê°€ë¥¼ ë³´ê³  "ë‚˜ëŠ” ë³„ë¡œ ë…¸ë ¥ ì•ˆ í•˜ëŠ” ê²ƒ ê°™ë‹¤."ê³  ê³ ë¯¼í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.<br> "ì´ë§Œí¼ í•˜ë©´ ë‚˜ì˜
                    ìŠ¹ë¦¬ë‹¤!"ë¼ê³  ë§í•  ìˆ˜ ìˆëŠ” ëª©í‘œë©´ ë©ë‹ˆë‹¤.
                </p>
                <p>
                    <button class="btn btn-success my-2" data-toggle="modal" data-target="#modal-howtouse" >ì‚¬ìš©ë°©ë²•</button>
                    <button class="btn btn-primary my-2" data-toggle="modal" onclick="setInput('', 'C');">ìƒˆë¡œ
                        ì§‘í•„í•˜ê¸°</button>
                    <% if(penName === undefined) { %>
                    <a href="/auth/register" class="btn btn-danger text-white">ì™„ì „ê°„ë‹¨í•˜ê²Œ ê°€ì…í•˜ê¸°</a>
                    <% } %>
                </p>
            </div>
        </section>
        <section>
            <div id="revos">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-inline">
                                <div class="form-group">
                                    <div class="input-group input-group-alternative mb-4">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        </div>
                                        <input class="search form-control form-control-alternative" placeholder="ì°¾ê¸°"
                                            type="text">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <ul class="col-md-12 list">
                            <% if(topics != null && topics.length >0) {%>
                            <% var i = 0; %>
                            <% while(i < topics.length) { %>
                            <div class="card card-stats mb-4">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-auto">
                                            <div class="avatar rounded-cicle bg-white mr-3 shadow profile">
                                                <% if(topics[i].file) { %>
                                                <img src='uploads/<%=topics[i].file%>' alt="profile img"
                                                    onclick="showUserInfo('<%=topics[i].authorid%>');">
                                                <%} else {%>
                                                <img alt="profile img" src="/images/profile_none.png"
                                                    onclick="showUserInfo('<%=topics[i].authorid%>');">
                                                <%}%>
                                            </div>
                                            <div class="author">
                                                <%= topics[i].name%>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <h4 class="title font-weight-bold"><a
                                                    href='/topic/<%=topics[i].id%>'><%=topics[i].title%></a></h4>
                                            <p class="text-muted">
                                                <%= topics[i].description %>
                                            </p>
                                        </div>
                                        <% if(penName == topics[i].name) { %>
                                        <div class="col-auto">
                                            <a class="edit" data-id='<%=topics[i].id%>' href="#"><i
                                                    class="fas fa-edit"></i></a>
                                        </div>
                                        <%}%>
                                        </div>
                                            <span class="badge badge-danger">
                                                    <i class="fas fa-heart"></i> <%= topics[i].likes %>
                                        </span>
                                        <span class="badge badge-info">
                                            <i class="fas fa-eye"></i> <%=topics[i].views%>
                                        </span>
                                        <span class="badge badge-success">
                                            <i class="fas fa-scroll"></i> <%=topics[i].chaptercnt%>
                                        </span>
                                    </div>
                                </div>
                                <% i++;}%>
                                <%}%>
                                </div>
                            </div>
                        </div>
                    </div>
        </section>
    <div class="modal fade" id="topicModal" tabindex="-1" role="dialog"
                    aria-labelledby="topicModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                                <form id="formTopic" action="/topic/create" method="post">
                                    <input id="topicId" type="hidden" name="id">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">ìƒˆë¡œ ì§‘í•„í•˜ê¸°</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                    <div class="form-group">
                                        <label for="title" class="col-form-label">ì œëª©</label>
                                        <input type="text" class="form-control" id="title" name="title">
                                    </div>
                                    <div class="form-group">
                                        <label for="description" class="col-form-label">ì„¤ëª…</label>
                                        <textarea class="form-control" id="description" name="description" cols="40" rows="5"></textarea>
                                    </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">ë‹«ê¸°</button>
                                <button type="submit" class="btn btn-primary">ì €ì¥</button>
                            </div>
                        </form>
                        </div>
                    </div>
        </div>
    </main>
    <footer class="text-muted">
        <div class="container">
        </div>
    </footer>
    <div class="modal fade" id="modal-userInfo" tabindex="-1" role="dialog" aria-labelledby="modal-notification" aria-hidden="true">
            <div class="modal-dialog modal-danger modal-dialog-centered modal-" role="document">
                <div class="modal-content bg-gradient-success">
                    <div class="modal-body">
                            <div class="card card-profile shadow">
                                <div class="row justify-content-center">
                                    <div class="col-lg-3 order-lg-2">
                                        <div class="card-profile-image">
                                          <a href="#">
                                            <img id="profileImage" src="/images/profile_none.png" class="rounded-circle">
                                          </a>
                                        </div>
                                      </div>
                                    </div>
                                <div class="card-body pt-0 pt-md-4">
                                    <div class="row">
                                        <div class="col">
                                          <div class="card-profile-stats d-flex justify-content-center mt-md-5">
                                           <div>
                                               <span>
                                                    <br><br>
                                               </span>
                                              <span>
                                                  <br>
                                              </span>
                                            </div> 
                                          </div>
                                        </div>
                                      </div>
                                      <div class="text-center">
                                        <h3>
                                          <span id="profilePenName"></span>
                                        </h3>
                                        <hr class="my-4">
                                        <p class="text-muted" id="profileComment" style="white-space: pre-line"></p>
                                        
                                      </div>
                                    </div>
                                  </div>
                    </div>
                </div>
            </div>
            </div>
            <div class="modal fade" id="modal-howtouse" tabindex="-1" role="dialog" aria-labelledby="modal-default" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-dialog-centered modal-" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h2 class="modal-title" id="modal-title-default">ì‚¬ìš©ë°©ë²•</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>

                <div class="modal-body">
                    <div class="container">
                            <h3>1. ê°€ì…ì„ í•©ë‹ˆë‹¤.</h3>
                            <p>
                            <img alt="howtouse1" src="/images/howtouse1.png">
                        </p>
                            <h3>2. ìœ„ìª½ì— ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¡œê·¸ì¸ë„ í•©ë‹ˆë‹¤.</h3>
                            <p>
                            <img alt="howtouse2" src="/images/howtouse2.png">
                        </p>
                            <h3>3. <span class="badge badge-primary">ìƒˆë¡œ ì§‘í•„í•˜ê¸°</span>ë¥¼ ëˆŒëŸ¬ ë„ì „í•  ì£¼ì œë¥¼ ì •í•´ì£¼ì„¸ìš”</h3>
                            <p>
                                    <img alt="howtouse3" src="/images/howtouse3.png"><br>
                                ë¬´ì—‡ì´ë“  ì¢‹ìŠµë‹ˆë‹¤. ì—°ì°¬, ìš´ë™, ê³µë¶€ ë“±... ìì‹ ë§Œì˜ ì¸ê°„í˜ëª…ì„ ë„ì „í•  ì£¼ì œë¥¼ ì •í•˜ì„¸ìš”.
                                    
                            </p>
                            <h3>4. ì£¼ì œ ì œëª©ì„ í´ë¦­í•©ë‹ˆë‹¤. ê·¸ëŸ¼ í•´ë‹¹ ì£¼ì œì— ê¸°ë¡ëœ ë‚´ìš©ë“¤ì´ ë³´ì…ë‹ˆë‹¤.</h3>
                            <p>
                                    <img alt="howtouse4" src="/images/howtouse4.png">
                                    í´ë¦­
                                </p>    
                            <h3>5. ë„˜ì–´ê°„ í˜ì´ì§€ì—ì„œ <span class="badge badge-primary">ìƒˆë¡œ ì‘ì„±í•˜ê¸°</span>ë¥¼ ëˆŒëŸ¬ ë§¤ì¼ë§¤ì¼ ê¸°ë¡í•˜ê³  ê³µìœ í•©ì‹œë‹¤!!</h3>
                            <p>
                                    <img alt="howtouse5" src="/images/howtouse5.png">
                                    <b>100% ìµëª…</b>ì´ë‹ˆ ì†”ì§í•˜ê³  ììœ ë¡­ê²Œ ì‘ì„±í•´ë³´ì•„ìš”~ ğŸ˜¸
                                </p>    
                    </div>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-link  ml-auto" data-dismiss="modal">ë‹«ê¸°</button>
                </div>

            </div>
    <a href="#" id="scroll" style="display: none;"><span></span></a>
</body>
<script type="text/javascript" src="../js/list.js"></script>

<script>
    $(function() {
        $('a.edit').click(function (e){
        e.preventDefault();
        var action = '/topic/update/' + $(this).data('id');
        
        $.getJSON(action, function (topic) {
            setInput(topic, 'U');
        });
    });
    });
    
    function setInput(topic, state) {
        var action;

        var penName = '<%- penName %>'
                                if(penName === '') {
                                alert('ê°€ì… í›„ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                                return false;
                                }else {
                                if(state === 'U') {

                                $('#topicId').val(topic[0].id);
                                $('#title').val(topic[0].title);
                                let desc = topic[0].description;
                                if(desc != null) {
                                desc.replace('\n', '<br>');
                                }
                                $('#description').val(desc);
                                action = `/topic/update_process`;
                                } else {
                                $('#title').val('');
                                $('#description').val('');
                                action = '/topic/create';
                                }
                                $("#formTopic").attr('action',action);

                                $('#topicModal').modal('show');
                                }
                                }

                                $("#formTopic").on("submit", function (e) {
                                e.preventDefault();

                                var data = {};
                                data.id = $('#topicId').val();
                                data.title = $("#title").val();
                                data.description = $("#description").val();


                                $.ajax({
                                url: $(this).attr('action'),
                                type: 'POST',
                                data: data,
                                success: function(result) {
                                }
                                });

                                $("#topicModal").modal('hide');
                                });

                                $("#topicModal").on('hidden.bs.modal', function () {
                                location.reload();
                                });

                                function showUserInfo(id) {
                                var data = {};
                                data.id = id;

                                $.ajax({
                                url: '/getUser',
                                type: 'POST',
                                data: data,
                                success: function (result) {
                                $("#profilePenName").text(result[0].penname);
                                $("#profileComment").text(result[0].profile);

                                if(result[0].file !== null) {
                                $("#profileImage").attr("src", "/uploads/"+ result[0].file);
                                } else {
                                $("#profileImage").attr("src", "/images/profile_none.png");
                                }
                                }
                                });
                                $("#modal-userInfo").modal("show");
                                }
                                </script>

</html>